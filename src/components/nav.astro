---
import Logo from "@/components/logo.astro";
---

<nav class="flex items-center justify-between w-full py-8 px-4">
    <Logo />

    <form id="newsletter-form" class="relative max-w-[300px]">
        <div class="relative w-full">
            <input
                id="email"
                required
                placeholder="your@email.com"
                type="email"
                name="email"
                class="w-full py-2 pr-20 pl-3 border border-gray-200 rounded-lg text-xs font-sans bg-(--bg-main) focus:outline-none"
            />
            <button
                id="submit-btn"
                type="submit"
                class="absolute right-1.5 top-1/2 -translate-y-1/2 px-2 py-1.5 bg-[#1a1a1a] text-white rounded-md font-normal text-xs inline-flex items-center justify-center leading-none font-sans border-none cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed"
            >
                Sign up
            </button>
        </div>
    </form>
</nav>

<script>
    const form = document.getElementById("newsletter-form") as HTMLFormElement;
    const submitBtn = document.getElementById(
        "submit-btn",
    ) as HTMLButtonElement;
    const emailInput = document.getElementById("email") as HTMLInputElement;

    if (form && submitBtn && emailInput) {
        form.addEventListener("submit", async (e) => {
            e.preventDefault();

            const originalText = submitBtn.textContent || "Sign up";
            const originalBgColor = "#1a1a1a";
            const lighterBgColor = "#2a2a2a";
            const email = emailInput.value;

            // Set loading state
            submitBtn.disabled = true;
            submitBtn.textContent = "Submitting...";
            submitBtn.style.backgroundColor = lighterBgColor;

            try {
                const formData = new FormData();
                formData.append("email", email);

                const response = await fetch("/api/newsletter", {
                    method: "POST",
                    body: formData,
                });

                const data = await response.json();

                if (response.ok && data.success) {
                    // Success state
                    submitBtn.textContent = "Signed up!";
                    submitBtn.style.backgroundColor = lighterBgColor;
                    submitBtn.disabled = true;
                } else {
                    // Error state
                    submitBtn.textContent = "Try again";
                    submitBtn.style.backgroundColor = lighterBgColor;
                    submitBtn.disabled = true;

                    // Reset after 2 seconds
                    setTimeout(() => {
                        submitBtn.textContent = originalText;
                        submitBtn.style.backgroundColor = originalBgColor;
                        submitBtn.disabled = false;
                    }, 2000);
                }
            } catch (error) {
                // Network error
                submitBtn.textContent = "Try again";
                submitBtn.style.backgroundColor = lighterBgColor;
                submitBtn.disabled = true;

                // Reset after 2 seconds
                setTimeout(() => {
                    submitBtn.textContent = originalText;
                    submitBtn.style.backgroundColor = originalBgColor;
                    submitBtn.disabled = false;
                }, 2000);
            }
        });
    }
</script>
